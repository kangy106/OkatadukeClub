# **ユースケース仕様書**

## **1. ユースケース一覧**
| ユースケース名             | 説明                                                                 |
|----------------------------|----------------------------------------------------------------------|
| 写真撮影とデータ送信       | ラズパイがカメラで写真を撮影し、サーバにデータを送信する。           |
| 写真判定処理               | サーバが受信した写真をAIサービスで判定し、結果を受け取る。           |
| 通知送信                   | サーバが判定結果を基にSlackに通知を送信する。                       |
| ラズパイ識別子とユーザ管理 | サーバがラズパイ識別子から机の使用者を特定する。                     |
| エラー処理                 | 写真撮影や判定時のエラーを検知し、適切なエラーメッセージを通知する。 |

---

## **2. 各ユースケース詳細**

### **2.1 写真撮影とデータ送信**
- **アクター**: Raspberry Pi
- **事前条件**:
  - カメラモジュールがラズパイに接続されている。
  - サーバが動作している。
- **説明**: 
  1. ラズパイが12時間ごと（7時、19時）にカメラで写真を撮影する。
  2. 撮影した写真をサーバに送信する。
  3. 写真撮影に失敗した場合は、エラーメッセージをサーバに送信する。
- **事後条件**:
  - サーバが写真データまたはエラーメッセージを受信する。

---

### **2.2 写真判定処理**
- **アクター**: サーバ、AIサービス
- **事前条件**:
  - サーバが写真データを受信している。
  - AIサービスが稼働している。
- **説明**: 
  1. サーバがラズパイから写真を受信する。
  2. サーバがAIサービスに写真を送信する。
  3. AIサービスが写真を解析し、以下のデータを返す。
     - 判定結果 (`clean` or `messy`)
     - 汚さスコア（例: 0〜100）
     - エラー情報（暗い、手が写っているなど）
- **事後条件**:
  - サーバがAIサービスから判定結果を受信し、次の処理（通知送信またはエラー処理）に進む。

---

### **2.3 通知送信**
- **アクター**: サーバ、Slack
- **事前条件**:
  - サーバがAIサービスから判定結果を受信している。
  - SlackのチャンネルとAPIトークンが設定されている。
  - ユーザ情報との紐付けができている。
- **説明**: 
  1. サーバが判定結果を基にSlackに通知を送信する。
  2. 通知内容には机の使用者名、判定スコア、写真URLが含まれる。
- **事後条件**:
  - Slackに通知が送信される。

---

### **2.4 ラズパイ識別子とユーザ管理**
- **アクター**: サーバ、データベース
- **事前条件**:
  - データベースにラズパイ識別子と机の使用者名が登録されている。
- **説明**: 
  1. サーバがラズパイ識別子を基に、データベースから机の使用者名を取得する。
  2. 使用者名を判定結果や通知に利用する。
- **事後条件**:
  - 使用者名が特定され、サーバの処理に利用される。

---

### **2.5 エラー処理**
- **アクター**: Raspberry Pi、サーバ
- **事前条件**:
  - 写真撮影や判定処理が異常な状態になった場合。
- **説明**: 
  1. 写真撮影やAIサービスの解析でエラーが発生した場合、エラーメッセージを生成。
  2. サーバがSlackにエラーメッセージを通知する。
- **事後条件**:
  - エラー内容がSlackに通知される。

---
