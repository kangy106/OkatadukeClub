# 機能要求定義書

## **1. 概要**
本システムは、Raspberry Pi（以下、ラズパイ）とサーバを連携させ、ラズパイに接続されたカメラで定期的に写真を撮影し、机の汚さを評価するサービスを提供します。また、異常が検知された場合や判定結果はSlackに通知します。

---

## **2. システム構成**
- **ラズパイ**
  - カメラモジュールを使用して写真を撮影し、サーバにデータを送信します。
  - 正常に写真が撮影できなかった場合はエラーメッセージをサーバに送信します。

- **サーバ**
  - ラズパイから写真データを受信し、AIサービスに画像を送信して机の汚さを判定します。
  - 判定結果やエラーメッセージをSlackに通知します。

---

## **3. 機能詳細**

### **3.1 ラズパイ**
#### **3.1.1 写真撮影**
- **タイミング**: 12時間に1回（7時、19時）
- **異常時の動作**: 写真撮影に失敗した場合、エラーメッセージをサーバに送信。

#### **3.1.2 サーバへの送信**
- **正常時**: 撮影した写真とラズパイの識別子をサーバに送信。
- **異常時**: エラーメッセージを送信。

---

### **3.2 サーバ**
#### **3.2.1 データ受信**
- **対象**: 複数のラズパイからデータを受信。
- **内容**:
  - 写真データ
  - ラズパイ識別子
  - エラーメッセージ（必要に応じて）

#### **3.2.2 AIサービスへの送信**
- **処理**: 受信した写真を外部の生成AIサービスに送信し、机の汚さを判定。

#### **3.2.3 判定結果の処理**
- **正常な写真**:
  - AIサービスから受け取った机の汚さスコアをSlackに通知。
  - 通知内容: 「ラズパイ識別子」「机の汚さスコア」「写真URL」

- **異常な写真**:
  - エラー判定（例: 暗い、手が写っているなど）をSlackに通知。
  - 通知内容: 「ラズパイ識別子」「エラーメッセージ」

---

## **4. 通信仕様**
### **4.1 ラズパイ→サーバ**
- **プロトコル**: HTTP POST
- **送信データ**:
  - `raspi_id`: ラズパイの識別子
  - `photo`: 撮影した写真データ
  - `error`（異常時のみ）: エラーメッセージ

### **4.2 サーバ→AIサービス**
- **プロトコル**: HTTP POST
- **送信データ**:
  - `image`: 写真データ

---

## **5. 通知仕様**
### **5.1 Slack通知**
- **プロトコル**: Slack API
- **通知内容**:
  - 正常時: 判定スコアと写真URL
  - 異常時: エラーメッセージ

---

## **6. 開発環境**
### **6.1 ラズパイ**
- **OS**: Raspberry Pi OS
- **主要ライブラリ**:
  - Python 3
  - `picamera`（カメラ制御）
  - `requests`（サーバ通信）

### **6.2 サーバ**
- **OS**: 任意（例: Ubuntu 20.04）
- **主要ライブラリ**:
  - Python 3
  - Flask（サーバフレームワーク）
  - `slack_sdk`（Slack通知）

### **6.3 AIサービス**
- **選択肢**:
  - Google Vision API
  - 自作モデル（例: TensorFlow/PyTorch）

---

## **7. 保守・運用**
- **ログ管理**:
  - ラズパイ: 撮影成功・失敗ログをローカル保存。
  - サーバ: 受信・判定・Slack通知ログを保存。

- **エラー通知**:
  - 写真撮影や判定処理で異常が発生した場合、即座にSlack通知。

- **拡張性**:
  - ラズパイの増設に対応可能。
  - 新たなAI判定機能の追加が容易。

---

[//]: # (## **8. 今後の課題**)

[//]: # (- AIサービスの判定精度向上。)

[//]: # (- サーバの負荷分散とスケーラビリティ確保。)